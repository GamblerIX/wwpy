# 小白完整使用指南

本指南将帮助您在Windows上一步步运行鸣潮服务端。
> 注意：全程需要科学上网。国内直接访问网速极慢。
> 另外，您需要使用可以指定游戏服务端地址的客户端，请自行寻找资源，或者查看：
> ``https://www.123865.com/s/87lLTd-nUt3A?pwd=r1nx``

## 环境配置

### 第一步：安装 Rust 编程环境

#### 下载和安装

1. **下载安装程序**

   * 访问链接下载：<https://static.rust-lang.org/rustup/dist/x86_64-pc-windows-msvc/rustup-init.exe>

2. **运行安装程序**

   * 双击下载的 `rustup-init.exe` 文件

   * 当出现安装选项时，直接按 **回车键** 选择默认配置


***

### 第二步：安装 Protocol Buffers 编译器

#### 自动安装（推荐）

1. **以管理员身份运行 PowerShell**

   * 按 Win+X，选择「Windows PowerShell (管理员)」

   * 或者按 Win+R，输入 `powershell`，然后按 Ctrl+Shift+Enter

2. **切换到项目目录**

   ```powershell
   cd "您的项目路径\wwpy\docs"
   ```

   例如：`cd "C:\Users\Administrator\Documents\GitHub\wwpy\docs"`

3. **执行安装脚本**

   ```powershell
   .\install_protoc.ps1
   ```

### 第三步：安装和配置 PostgreSQL 数据库

#### 下载和安装数据库

1. **下载安装程序**

   * 访问链接：<https://get.enterprisedb.com/postgresql/postgresql-17.5-3-windows-x64.exe>

   * 下载 PostgreSQL 17.5 版本

2. **运行安装程序**

   * 双击下载的安装文件

   * 在安装过程中，当要求设置 postgres 用户密码时，请设置为：`Aa123456`

   * 其他选项保持默认，完成安装

#### 配置数据库

安装完成后，需要创建项目专用的数据库和用户：

1. **打开命令提示符**

   * 按 Win+R，输入 `cmd` 并回车

2. **进入 PostgreSQL 安装目录**

   ```PowerShell
   cd C:\Program Files\PostgreSQL\17\bin
   ```

3. **连接到数据库**

   ```PowerShell
   psql -U postgres -h 127.0.0.1 -p 5432
   ```

   * 系统会提示输入密码，输入 `Aa123456` 并回车

   * 成功连接后会显示 `postgres=#` 提示符

4. **创建项目数据库**

   ```SQL
   CREATE DATABASE users;
   ```

   * 成功后会显示 `CREATE DATABASE`

5. **创建项目用户**

   ```SQL
   CREATE USER users WITH PASSWORD 'password';
   ```

   * 成功后会显示 `CREATE ROLE`

6. **切换到项目数据库**

   ```SQL
   \c users
   ```

   * 成功后会显示 `You are now connected to database "users" as user "postgres"`

7. **设置用户权限**
   依次执行以下命令：

   ```SQL
   GRANT CREATE, USAGE ON SCHEMA public TO users;
   ```

   ```SQL
   GRANT ALL PRIVILEGES ON ALL TABLES IN SCHEMA public TO users;
   ```

   ```SQL
   ALTER DEFAULT PRIVILEGES IN SCHEMA public GRANT ALL PRIVILEGES ON TABLES TO users;
   ```

   <br />

   * 成功后分别会显示 `GRANT`,`GRANT`,`ALTER DEFAULT PRIVILEGES`

8. **退出数据库终端**

   ```SQL
   \q
   ```

#### 数据库连接信息

配置完成后，项目将使用以下连接信息：

* **主机地址**：127.0.0.1:5432

* **数据库名**：users

* **用户名**：users

* **密码**：password

***

### 第四步：安装python

#### 下载和安装

1. **下载安装程序**

   * 访问链接：<https://www.python.org/ftp/python/3.13.6/python-3.13.6-amd64.exe>

2. **运行安装程序**

   * 双击下载的安装文件

   * 勾选「Add Python to PATH」

   * 点击「Install Now」

   * 安装完成后，点击「Close」关闭安装程序

### 第五步：安装Git

#### 下载和安装

1. **下载安装程序**

   * 访问链接：<https://github.com/git-for-windows/git/releases/download/v2.50.1.windows.1/Git-2.50.1-64-bit.exe>

2. **运行安装程序**

   * 双击下载的安装文件

   * 始终保持默认选项，一路点击「Next」

   * 出现「Install」时点击

   * 安装完成后，点击「Finish」关闭安装程序

### ✅ 环境验证

完成所有安装后，请验证五个组件都已正确安装：

```PowerShell
rustc --version
# 输出类似：rustc 1.88.0 (6b00bc388 2025-06-23)
```

```PowerShell
protoc --version
# 输出必须完全相同：libprotoc 29.5
```

```PowerShell
python --version
# 输出必须完全相同：Python 3.13.6
```

```PowerShell
git --version
# 输出必须完全相同：git version 2.50.1.windows.1
```

在开始菜单栏中找到PostgreSQL 17文件夹，点击打开其中的pgAdmin 4，成功进入则说明PostgreSQL数据库安装成功。（数据库连接信息通过脚本检查）


## 开始运行

1. **克隆项目仓库**

   ```PowerShell
   git clone https://github.com/GamblerIX/wwpy.git
   ```

2. **切换到项目目录**

   ```PowerShell
   cd wwpy
   ```

3. **安装Python依赖**

   ```PowerShell
   pip install -r requirements.txt
   ```

4. **进入主菜单**

   ```PowerShell
   python main.py
   ```

5. **运行服务端**

   提示请选择操作后，输入2并回车。
   脚本将检查环境，若通过将开始运行服务端。
   注意小米管家和此服务端不能一同运行，脚本将自动关闭小米管家。（占用端口10001重合）

6. **退出运行菜单**

   所有服务端启动完毕后，按下Ctrl+C组合键退出运行菜单。

恭喜！服务端已运行。

## 停止运行

1. **进入主菜单**

   ```PowerShell
   python main.py
   ```

2. **停止服务端**

   进入主菜单后，输入3并回车。
   脚本将提示是否停止服务端，输入y并回车确认停止服务端。
   脚本将检查服务端是否运行，随即停止运行的服务端。

以上就是服务端的小白完整使用指南。更多进阶版，详见项目代码或者主菜单。